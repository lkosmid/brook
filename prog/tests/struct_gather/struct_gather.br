// struct_gather.br

#include <stdio.h>

typedef struct Pair_t {
  float first;
  float second;
} Pair;

kernel void gatherPairs( float index<>, Pair pairs[], out float result<> ) {
  Pair p = pairs[index];
  result = p.first + p.second;
}

int main() {
  Pair pairs< 100 >;
  float indices< 100 >;
  float output< 100 >;
  Pair pairs_data[100];
  float indices_data[100];
  float output_data[100];
  int i;

  for( i = 0; i < 100; i++ )
  {
    pairs_data[i].first = (float)i;
    pairs_data[i].second = (float)(i*100);
    indices_data[i] = (float)(99-i);
  }

  streamRead( pairs, pairs_data );
  streamRead( indices, indices_data );
  gatherPairs( indices, pairs, output );
  streamWrite( output, output_data );
	
	for( i = 0; i < 100; i++ )
	{
		printf( "%6.1f ", output_data[i] );
    if( i % 10 == 9 )
      printf("\n");
	}
	
	return 0;
}
