/*
 * Iterator.br --
 *
 *      Simple demo / regression test for iterator pseudo-streams.
 */

#include <stdio.h>
void __kprintf_cpu_inner(float f) {
   fprintf(stderr,"%f | ",f);
}
/* This kernel should make a matrix of 1 and a diagonal of 0's*/
kernel void
iterator_test (float d<>, iter float iterator<>, out float e<>)
{
   kprintf(iterator);
   e = iterator + d;
}

int
main (int argc, char *argv[]) {
   iter float2 ian<200, 100> = BRTIter(0.0f, 0.0f, 200.0f, 100.0f);
   iter float tim<10> = BRTIter(0.0f, 200.0f);
   float d<10>;
   float e<10>;

   float data_d[10];
   float data_e[10];
   int i;

   for (i=0; i<10; i++) {
      data_d[i] = ((float) i) / 100.0f;
   }

   streamRead(d, data_d);
   iterator_test(d,tim,e);
   streamWrite(e, data_e);

   for (i=0; i<10; i++) {
      printf("%3.2f ", data_e[i]);
   }
   printf("\n");
   return 0;
}
