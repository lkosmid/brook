// big.br
// tests big streams with address-translation

#include <stdio.h>

kernel void copy( float a<>, out float b<> ) {
	b = a;
}

int main( int argc, char** argv ) {
	int SIZE = atoi( argv[1] );
  int SIZE2 = 2*SIZE;
	int i, j;
	
	float a< SIZE >;
	float b< SIZE2 >;
	float* a_data;
	float* b_data;
	
	a_data = (float*)malloc( SIZE*sizeof(float) );
	b_data = (float*)malloc( SIZE2*sizeof(float) );

	for( i = 0; i < SIZE; i++ )
	{
		a_data[i] = (float)i;
	}

	streamRead( a, a_data );
	copy( a, b );
	streamWrite( b, b_data );

	for( i = 0; i < SIZE2; i++ )
	{
		j = (i/2);
		if( b_data[i] != j )
			printf( "[%d] %f != %d\n", i, b_data[i], j );
	}
	printf( "done\n" );

	return 0;
}
